(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e837d2b"],{"06e4":function(e,t,a){},"0deb":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"raffle-operator-wrapper app-container"},[a("div",{staticClass:"raffle-operator__header"},[a("h5",[e._v(e._s("add"===e.type?"新建抽奖":"编辑抽奖"))])]),a("div",{staticClass:"raffle-operatore__content"},[a("el-form",{ref:"raffleForm",attrs:{model:e.param,"label-width":"160px","label-position":"right",rules:e.rules}},[a("el-card",{staticClass:"card-common"},[a("div",{staticClass:"title",attrs:{slot:"header"},slot:"header"},[e._v("基本信息")]),a("el-form-item",{attrs:{label:"抽奖名称：",prop:"luckDrawName"}},[a("el-input",{staticStyle:{width:"60%"},attrs:{placeholder:"请输入抽奖名称"},model:{value:e.param.luckDrawName,callback:function(t){e.$set(e.param,"luckDrawName",t)},expression:"param.luckDrawName"}})],1),a("el-form-item",{staticClass:"is-required",attrs:{label:"活动国家："}},[a("el-select",{attrs:{disabled:"edit"===e.type,filterable:""},on:{change:e.handleCountryChange},model:{value:e.param.countryCode,callback:function(t){e.$set(e.param,"countryCode",t)},expression:"param.countryCode"}},e._l(e.countryList,(function(e){return a("el-option",{key:e.shortCode,attrs:{label:e.nameLocal,value:e.shortCode}})})),1)],1),a("el-form-item",{attrs:{label:"活动时间：",prop:"startTime"}},[a("el-date-picker",{staticStyle:{width:"60%"},attrs:{type:"datetimerange","value-format":"timestamp","start-placeholder":"开始时间","end-placeholder":"结束时间","default-time":["00:00:00","23:59:59"]},on:{change:e.setActivityTime},model:{value:e.timeList,callback:function(t){e.timeList=t},expression:"timeList"}})],1)],1),a("el-card",{staticClass:"card-common"},[a("div",{staticClass:"title",attrs:{slot:"header"},slot:"header"},[e._v("奖池设置")]),a("el-form-item",{staticClass:"is-required",attrs:{label:"奖池清单："}},[a("div",{staticClass:"tip"},[e._v("请将用户抽奖可能出现的所有结果（含未中奖的反馈）列举在下方；奖品清单允许修改且每次投放时系统将以最新为准")]),a("el-table",{style:{width:"90%"},attrs:{data:e.param.luckPrizeInfo,"header-cell-style":{background:"#F5F7FA",color:"#606266"},border:"","show-summary":""}},[a("el-table-column",{key:"1",attrs:{label:"奖品ID",align:"center",prop:"luckPrizeId"}}),a("el-table-column",{key:"2",attrs:{label:"奖品名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                "+e._s(e.getName(t.row.luckPrizeName,"cn"))+"\n                            ")]}}])}),a("el-table-column",{key:"3",attrs:{label:"奖品类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                "+e._s(e.luckPrizeTypeMap[t.row.luckPrizeType])+"\n                            ")]}}])}),a("el-table-column",{key:"4",attrs:{label:"奖品数量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.onceNumber))]}}])}),a("el-table-column",{key:"5",attrs:{label:"抽中概率",align:"center",prop:"winningProbability"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.winningProbability+"%"))]}}])}),a("el-table-column",{key:"6",attrs:{label:"操作",align:"center",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("i",{staticClass:"el-icon-edit icon mr10",on:{click:function(a){return e.handleEdit(t.row,t.$index)}}}),a("i",{staticClass:"el-icon-close icon",on:{click:function(a){return e.handleDelete(t.$index)}}})]}}])})],1),a("el-button",{attrs:{type:"text"},on:{click:e.handleAdd}},[e._v("再加一种奖品")])],1),a("el-form-item",{staticClass:"is-required",attrs:{label:"投放频率：",prop:"increaseValue"}},[a("el-radio-group",{model:{value:e.param.increaseFrequency,callback:function(t){e.$set(e.param,"increaseFrequency",t)},expression:"param.increaseFrequency"}},[a("el-radio",{staticClass:"radio-line",attrs:{label:2}},[e._v("循环投放：指定时分，并按活动期内的自然天数循环投放")]),a("el-radio",{staticClass:"radio-line",attrs:{label:1}},[e._v("定时投放：指定年月日及时分秒单次投放")])],1),a("div",{staticClass:"tip mt20"},[e._v("最多可设置5个阶梯，且优惠不叠加")]),a("ul",{directives:[{name:"show",rawName:"v-show",value:1===e.param.increaseFrequency,expression:"param.increaseFrequency === 1"}]},e._l(e.increaseList1,(function(t,i){return a("li",{key:i},[e._v("\n                            时刻"+e._s(i+1)+" "),a("el-date-picker",{staticClass:"mrl16",attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",size:"medium",clearable:!1,disabled:!(e.param.startTime&&e.param.endTime)},on:{change:function(t,a){return e.handleIncreaseTimeChange(t,a)}},model:{value:t.time,callback:function(a){e.$set(t,"time",a)},expression:"item.time"}}),a("el-button",{directives:[{name:"show",rawName:"v-show",value:i===e.increaseList1.length-1&&e.increaseList1.length<5,expression:"index === increaseList1.length - 1 && increaseList1.length < 5"}],attrs:{type:"text"},on:{click:function(t){return e.handleTimeAdd(1)}}},[e._v("增加")]),e.increaseList1.length>1?a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelTime(1,i)}}},[e._v("删除")]):e._e()],1)})),0),a("ul",{directives:[{name:"show",rawName:"v-show",value:2===e.param.increaseFrequency,expression:"param.increaseFrequency === 2"}]},e._l(e.increaseList2,(function(t,i){return a("li",{key:i},[e._v("\n                            时刻"+e._s(i+1)+" "),a("el-time-picker",{staticClass:"mrl16",attrs:{size:"medium","value-format":"HH:mm:ss",clearable:!1},model:{value:t.time,callback:function(a){e.$set(t,"time",a)},expression:"item.time"}}),a("el-button",{directives:[{name:"show",rawName:"v-show",value:i===e.increaseList2.length-1&&e.increaseList2.length<5,expression:"index === increaseList2.length - 1 && increaseList2.length < 5"}],attrs:{type:"text"},on:{click:function(t){return e.handleTimeAdd(2)}}},[e._v("增加")]),e.increaseList2.length>1?a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelTime(2,i)}}},[e._v("删除")]):e._e()],1)})),0)],1),a("el-form-item",{staticClass:"is-required",attrs:{label:"投放方式："}},[a("el-radio-group",{model:{value:e.param.increaseType,callback:function(t){e.$set(e.param,"increaseType",t)},expression:"param.increaseType"}},[a("el-radio",{staticClass:"radio-line",attrs:{label:1}},[e._v("增量投放：每次投放新的奖品时不清空现有奖池")]),a("el-radio",{staticClass:"radio-line",attrs:{label:2}},[e._v("清空投放：每次投放新的奖品时清空现有奖池")])],1)],1)],1),a("el-card",{staticClass:"card-common"},[a("div",{staticClass:"title",attrs:{slot:"header"},slot:"header"},[e._v("抽奖机会")]),a("el-form-item",{staticClass:"is-required",attrs:{label:"无条件机会："}},[a("el-radio-group",{model:{value:e.param.freeType,callback:function(t){e.$set(e.param,"freeType",t)},expression:"param.freeType"}},[a("el-radio",{staticClass:"radio-line highLH",attrs:{label:1}},[e._v("\n                            每个用户ID "),a("el-input-number",{attrs:{controls:!1,min:0,max:1e3,precision:0,placeholder:"抽奖机会"},model:{value:e.freeNumber1,callback:function(t){e.freeNumber1=t},expression:"freeNumber1"}}),e._v(" 次/每自然天\n                        ")],1),a("el-radio",{staticClass:"radio-line highLH",attrs:{label:2}},[e._v("\n                            每个用户ID "),a("el-input-number",{attrs:{controls:!1,min:0,max:1e3,precision:0,placeholder:"抽奖机会"},model:{value:e.freeNumber2,callback:function(t){e.freeNumber2=t},expression:"freeNumber2"}}),e._v(" 次（活动全程）\n                        ")],1)],1)],1),a("el-form-item",{staticClass:"is-required",attrs:{label:"机会用光反馈："}},[a("div",{staticClass:"tip"},[e._v("指抽奖活动期间，无抽奖机会的用户尝试抽奖时，反馈给用户提醒文案；")]),a("el-radio-group",{model:{value:e.param.zeroNumTipsType,callback:function(t){e.$set(e.param,"zeroNumTipsType",t)},expression:"param.zeroNumTipsType"}},[a("el-radio",{staticClass:"radio-line",attrs:{label:1}},[e._v("弹窗")]),a("el-form-item",{staticClass:"special-item",attrs:{label:"图片：","label-width":"80px",prop:"zeroList1"}},[a("multi-lang-file-upload",{attrs:{propFileList:e.param.zeroList1,accept:"image/jpeg,image/jpg,image/png,image/gif"},on:{setData:e.setImg}})],1),a("el-form-item",{staticClass:"special-item",attrs:{label:"链接：","label-width":"80px",prop:"tipsUrl"}},[a("el-input",{model:{value:e.param.tipsUrl,callback:function(t){e.$set(e.param,"tipsUrl",t)},expression:"param.tipsUrl"}})],1),a("el-radio",{staticClass:"radio-line",attrs:{label:2}},[e._v("文案：\n                            "),a("el-select",{staticStyle:{width:"27%"},model:{value:e.nameLang,callback:function(t){e.nameLang=t},expression:"nameLang"}},e._l(e.languageList,(function(e){return a("el-option",{key:e.code,attrs:{label:e.desc,value:e.code}})})),1),e._l(e.param.zeroList2,(function(t,i){return a("div",{directives:[{name:"show",rawName:"v-show",value:e.nameLang===t.languageCode,expression:"nameLang === item.languageCode"}],key:t.languageCode,staticClass:"name-input"},[a("el-form-item",{attrs:{prop:"zeroList2["+i+"].name",rules:{required:("cn"==t.languageCode||"en"==t.languageCode)&&2==e.param.zeroNumTipsType,message:"中英文必填",trigger:"blur"}}},[a("el-input",{attrs:{type:"text",placeholder:"请输入"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"item.name"}})],1)],1)}))],2)],1)],1)],1)],1)],1),a("div",{staticClass:"raffle-operator__footer"},[a("el-button",{staticClass:"foot-btn",on:{click:e.handleCancel}},[e._v("取消")]),a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"foot-btn",attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("确定")])],1),a("award-dialog",{attrs:{"dialog-visible":e.awardShow,awardData:e.awardData,countryCode:e.param.countryCode,awardType:e.awardType,langTemplateList:e.langTemplateList},on:{close:function(t){e.awardShow=!1},save:e.handlePrizeItemSave}})],1)},n=[],r=(a("8e6e"),a("456d"),a("6762"),a("ac6a"),a("20d6"),a("bd86")),s=(a("7f7f"),a("7514"),a("5880")),l=a("7bf4"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"award-manage-dialog",attrs:{title:"奖品管理",width:"650px",visible:e.dialogVisible,"close-on-click-modal":!1},on:{close:e.handleClose}},[a("el-form",{ref:"awardManageForm",attrs:{"label-width":"130px","label-position":"right",model:e.param,rules:e.rules}},[a("el-form-item",{staticClass:"is-required",attrs:{label:"选择类型："}},[a("el-select",{staticStyle:{width:"90%"},attrs:{disabled:"edit"===e.awardType},model:{value:e.param.luckPrizeType,callback:function(t){e.$set(e.param,"luckPrizeType",t)},expression:"param.luckPrizeType"}},e._l(e.luckPrizeTypeList,(function(e){return a("el-option",{key:e.key,attrs:{value:e.key,label:e.name}})})),1)],1),[a("el-form-item",{staticClass:"is-required",attrs:{label:"奖品名称："}},[a("el-select",{staticStyle:{width:"24%"},model:{value:e.nameLang,callback:function(t){e.nameLang=t},expression:"nameLang"}},e._l(e.languageList,(function(e){return a("el-option",{key:e.code,attrs:{label:e.desc,value:e.code}})})),1),e._l(e.param.luckPrizeName,(function(t,i){return a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.nameLang===t.languageCode,expression:"nameLang === item.languageCode"}],key:t.languageCode,staticClass:"name-input",attrs:{prop:"luckPrizeName["+i+"].name",rules:{required:"cn"==t.languageCode||"en"==t.languageCode,message:"中英文必填",trigger:"blur"}}},[a("el-input",{attrs:{type:"text",placeholder:"请输入"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"item.name"}})],1)}))],2),a("el-form-item",{attrs:{label:"奖品图片："}},[e.dialogVisible?a("c-upload",{attrs:{fileList:e.param.image,limit:1},on:{setData:e.setCoverImg}}):e._e()],1),1===e.param.luckPrizeType?a("el-form-item",{staticClass:"is-required",attrs:{label:"奖品内容："}},[a("el-table",{style:{width:"90%"},attrs:{data:e.param.dataList,"header-cell-style":{background:"#F5F7FA",color:"#606266"}}},[a("el-table-column",{attrs:{label:"优惠券",width:"240",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"dataList."+t.$index+".coupon",rules:e.rules.requireInput}},[a("el-input",{model:{value:t.row.coupon,callback:function(a){e.$set(t.row,"coupon",a)},expression:"scope.row.coupon"}})],1)]}}],null,!1,2793234871)}),a("el-table-column",{attrs:{label:"数量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{staticClass:"config-common-input",attrs:{controls:!1,precision:0,min:1},model:{value:t.row.num,callback:function(a){e.$set(t.row,"num",a)},expression:"scope.row.num"}})]}}],null,!1,4012205310)}),a("el-table-column",{attrs:{label:"操作",width:"96",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index===e.param.dataList.length-1&&t.$index?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleDelete(t.$index)}}},[e._v("删除")]):e._e(),t.$index===e.param.dataList.length-1?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleAdd(t.row)}}},[e._v("新增")]):e._e()]}}],null,!1,729592232)})],1)],1):e._e(),5==e.param.luckPrizeType?[a("el-form-item",{staticClass:"is-required",attrs:{label:"积分金额："}},[e._v("\n                    "+e._s(e.getCurrencyUnit(e.countryCode,"currencyUnit"))+"\n                    "),a("el-input-number",{attrs:{min:e.pointLimit[e.countryCode].min,controls:!1,precision:e.pointLimit[e.countryCode].precision},model:{value:e.param.pointsMin,callback:function(t){e.$set(e.param,"pointsMin",t)},expression:"param.pointsMin"}}),e._v(" ~\n                    "),a("el-input-number",{attrs:{min:e.pointLimit[e.countryCode].min,precision:e.pointLimit[e.countryCode].precision,controls:!1},model:{value:e.param.pointsMax,callback:function(t){e.$set(e.param,"pointsMax",t)},expression:"param.pointsMax"}})],1),a("el-form-item",{staticClass:"is-required",attrs:{label:"单次投放量："}},[a("el-input-number",{attrs:{controls:!1,min:0,precision:0},model:{value:e.param.onceNumber,callback:function(t){e.$set(e.param,"onceNumber",t)},expression:"param.onceNumber"}})],1)]:e._e(),6==e.param.luckPrizeType?[a("el-form-item",{staticClass:"is-required",attrs:{label:"金币："}},[a("el-input-number",{attrs:{min:e.pointLimit[e.countryCode].min,controls:!1,precision:0},model:{value:e.param.pointsMin,callback:function(t){e.$set(e.param,"pointsMin",t)},expression:"param.pointsMin"}}),e._v(" ~\n                    "),a("el-input-number",{attrs:{min:e.pointLimit[e.countryCode].min,precision:0,controls:!1},model:{value:e.param.pointsMax,callback:function(t){e.$set(e.param,"pointsMax",t)},expression:"param.pointsMax"}})],1),a("el-form-item",{staticClass:"is-required",attrs:{label:"单次投放量："}},[a("el-input-number",{attrs:{controls:!1,min:0,precision:0},model:{value:e.param.onceNumber,callback:function(t){e.$set(e.param,"onceNumber",t)},expression:"param.onceNumber"}})],1)]:4!==e.param.luckPrizeType?a("el-form-item",{staticClass:"is-required",attrs:{label:"单次投放量："}},[a("el-input-number",{attrs:{controls:!1,min:0,precision:0,max:e.numLimit[e.param.luckPrizeType]},model:{value:e.param.onceNumber,callback:function(t){e.$set(e.param,"onceNumber",t)},expression:"param.onceNumber"}}),a("div",{staticClass:"tip"},[e._v("注意：单次投放量 * 投放次数 = 活动期间的总投放量，请合理计算避免超出运营计划成本")])],1):e._e(),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:4!==e.param.luckPrizeType,expression:"param.luckPrizeType !== 4"}],staticClass:"is-required",attrs:{label:"抽中概率："}},[a("el-input-number",{attrs:{controls:!1,min:0,max:100,precision:4,size:"medium"},model:{value:e.param.winningProbability,callback:function(t){e.$set(e.param,"winningProbability",t)},expression:"param.winningProbability"}}),e._v("%\n            ")],1)],a("el-form-item",{staticClass:"is-required",attrs:{label:"抽中反馈："}},[a("el-radio-group",{model:{value:e.param.winningTipsType,callback:function(t){e.$set(e.param,"winningTipsType",t)},expression:"param.winningTipsType"}},[a("el-radio",{staticClass:"radio-line",attrs:{label:1}},[e._v("弹窗")]),a("el-form-item",{staticClass:"special-item",attrs:{label:"图片：","label-width":"80px",prop:"winningList1"}},[a("multi-lang-file-upload",{attrs:{propFileList:e.param.winningList1,accept:"image/jpeg,image/jpg,image/png,image/gif"},on:{setData:e.setImg}})],1),a("el-form-item",{staticClass:"special-item",attrs:{label:"链接：","label-width":"80px"}},[a("el-input",{model:{value:e.param.winningTipsUrl,callback:function(t){e.$set(e.param,"winningTipsUrl",t)},expression:"param.winningTipsUrl"}})],1),a("el-radio",{staticClass:"radio-line",attrs:{label:2}},[e._v("文案：\n                    "),a("el-select",{staticStyle:{width:"26%"},model:{value:e.descLang,callback:function(t){e.descLang=t},expression:"descLang"}},e._l(e.languageList,(function(e){return a("el-option",{key:e.code,attrs:{label:e.desc,value:e.code}})})),1),e._l(e.param.winningList2,(function(t,i){return a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.descLang===t.languageCode,expression:"descLang === item.languageCode"}],key:t.languageCode,staticClass:"small-width",attrs:{rules:{required:("cn"==t.languageCode||"en"==t.languageCode)&&2===e.param.winningTipsType,message:"中英文必填",trigger:"blur"},prop:"winningList2["+i+"].name"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"item.name"}})],1)}))],2)],1)],1)],2),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.handleClose}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",size:"small",loading:e.pending},on:{click:e.handleConfirm}},[e._v("确 定")])],1)],1)},c=[],u=a("75fc"),m=a("f09b"),p={props:{dialogVisible:Boolean,awardData:Object,langTemplateList:Array,awardType:String,countryCode:String},components:{multiLangFileUpload:l["a"],cUpload:m["a"]},data:function(){var e=this;return{typeList:{},pending:!1,param:{id:"",luckDrawId:"",luckPrizeId:"",luckPrizeType:1,luckPrizeName:[],dataList:[],pointsMin:0,pointsMax:0,onceNumber:0,winningProbability:0,winningTipsType:1,winningTipsUrl:"",winningList1:[],winningList2:[],image:""},rules:{requireInput:[{required:!0,message:"必填",trigger:"change"}],winningList1:[{validator:function(t,a,i){var n=e.param.winningTipsType;if(1==n){var r=a.find((function(e){if("cn"===e.languageCode||"en"===e.languageCode)return e.name}));return r?i():i(new Error("不能为空"))}return i()},trigger:"blur"}]},nameLang:"cn",descLang:"cn",numLimit:{1:9999,2:999999,3:999999,4:1/0},pointLimit:{MY:{min:.01,max:1e4,precision:2,onceNumberTotal:3e4,twoTipNum:150},SG:{min:.01,max:1e3,precision:2,onceNumberTotal:1e4,twoTipNum:50},TH:{min:1,max:5e4,precision:0,onceNumberTotal:2e5,twoTipNum:1e3}},luckPrizeTypeList:[{key:1,name:"优惠券"},{key:2,name:"奖品"},{key:3,name:"非奖品"},{key:4,name:"保险栓"},{key:5,name:"积分"},{key:6,name:"金币"}]}},watch:{awardData:{handler:function(e){var t=JSON.parse(JSON.stringify(e));if("edit"!==this.awardType)t.winningList2=JSON.parse(JSON.stringify(this.langTemplateList)),t.winningList1=JSON.parse(JSON.stringify(this.langTemplateList)),t.luckPrizeName=JSON.parse(JSON.stringify(this.langTemplateList)),Object.assign(this.param,t),t.dataList&&t.dataList.length||this.handleAdd();else{t.dataList=t.couponList?JSON.parse(t.couponList):[];var a=this.onFillList(t.winningTipsDesc);t.winningList1=1===t.winningTipsType?a:JSON.parse(JSON.stringify(this.langTemplateList)),t.winningList2=2===t.winningTipsType?a:JSON.parse(JSON.stringify(this.langTemplateList));var i=this.onFillList(t.luckPrizeName);if(t.luckPrizeName=i,!t.dataList||!t.dataList.length){var n={coupon:"",num:1};t.dataList.push(n)}delete t.couponList,delete t.winningTipsDesc,Object.assign(this.param,t)}},deep:!0}},computed:{languageList:function(){return this.$store.state.dict.languageList}},methods:{onFillList:function(e){var t=this,a=this.languageList.length;if(e.length===a)return e;for(var i=JSON.parse(JSON.stringify(e)),n=function(e){var a=t.languageList[e],n=i.findIndex((function(e){return e.languageCode===a.code}));-1===n&&i.push({languageCode:a.code,name:""})},r=0;r<a;r++)n(r);return i},setCoverImg:function(e){this.param.image=e.data},handleDelete:function(e){var t=this;this.$confirm("确认删除该条记录吗？","提示").then((function(){t.param.dataList.splice(e,1)})).catch((function(){}))},handleAdd:function(){var e={coupon:"",num:1};this.param.dataList.push(e)},handleOnceNumChange:function(e){e>100&&this.$message({type:"warning",message:"上限".concat(this.numLimit[this.param.luckPrizeType])})},setImg:function(e){this.param.winningList1=e},reset:function(){this.nameLang="cn",this.descLang="cn",this.$refs["awardManageForm"].clearValidate()},handleClose:function(){this.reset(),this.$emit("close")},normalizeParam:function(){var e=JSON.parse(JSON.stringify(this.param));return e.winningTipsDesc=e["winningList"+e.winningTipsType],1===e.luckPrizeType&&(e.dataList=e.dataList.map((function(e){return e.num=e.num+"",e})),e.couponList=JSON.stringify(e.dataList)),delete e.dataList,delete e.winningList1,delete e.winningList2,e.pointsMax+="",e.pointsMin+="",e.winningProbability=e.winningProbability?e.winningProbability+"":"0",e.onceNumber=e.onceNumber||0,e},isRepeat:function(e){var t={};for(var a in e){if(t[e[a].coupon])return!0;t[e[a].coupon]=!0}return!1},onSave:function(e){var t=this;"edit"===this.awardType&&e?this.$confirm("您确定要修改奖品名称吗？这会导致用户已获得的奖品名称也将同步更新，请谨慎操作!","提示",{type:"warning"}).then((function(){t.$refs["awardManageForm"].validate((function(e){if(e){t.pending=!0;var a=t.normalizeParam();t.$emit("save",{luckItem:a}),t.pending=!1,t.reset()}else t.$message.error("提示：请确认中英文已填写")}))})).catch((function(){t.$message({type:"info",message:"已撤销更改"});var e=t.onFillList(t.awardData.luckPrizeName);t.param.luckPrizeName=e})):this.$refs["awardManageForm"].validate((function(e){if(e){t.pending=!0;var a=t.normalizeParam();t.$emit("save",{luckItem:a}),t.pending=!1,t.reset()}else t.$message.error("提示：请确认中英文已填写")}))},handleConfirm:function(){for(var e=this,t=!1,a=Object(u["a"])(this.param.luckPrizeName),i=JSON.parse(JSON.stringify(this.param)),n=function(i){var n=a[i];if(t=e.awardData.luckPrizeName.find((function(e){return e.languageCode===n.languageCode&&e.name!==n.name})),t)return"break"},r=0;r<a.length;r++){var s=n(r);if("break"===s)break}var l=this.isRepeat(i.dataList);if(l)this.$message.error("优惠券ID不能重复");else if(5==i.luckPrizeType||6==i.luckPrizeType){if(!i.pointsMin||!i.pointsMax)return void this.$message.error("金额必填");if(i.pointsMax<i.pointsMin)return void this.$message.error("金额左边需小于或等于右边的值");if(i.pointsMax>this.pointLimit[this.countryCode].max)return void this.$message.error("金额过大，无法提交");if(i.pointsMax>=this.pointLimit[this.countryCode].twoTipNum)this.$confirm("你设定的金额较大，确认要保存吗？","提示",{type:"warning"}).then((function(){var a=Math.round(e.pointLimit[e.countryCode].onceNumberTotal/i.pointsMax);i.onceNumber>a?e.$message.error("单次投放量过高，无法提交"):e.onSave(t)})).catch((function(){e.$message({type:"info",message:"已取消"})}));else{var o=Math.round(this.pointLimit[this.countryCode].onceNumberTotal/i.pointsMax);i.onceNumber>o?this.$message.error("单次投放量过高，无法提交"):this.onSave(t)}}else i.onceNumber>100&&4!==i.luckPrizeType?this.$confirm("当前设置的单次投放量过高，请确认是否修改","提示",{type:"warning"}).then((function(){e.onSave(t)})):this.onSave(t)}}},d=p,g=(a("8c16"),a("2877")),f=Object(g["a"])(d,o,c,!1,null,"afa7de44",null),h=f.exports,b=a("5e41"),v=a("c32d"),y=a.n(v),L=a("aa47");a("2ef0");function w(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function k(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?w(Object(a),!0).forEach((function(t){Object(r["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):w(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var T={data:function(){var e=this;return{type:"",param:{luckDrawName:"",countryCode:"MY",luckPrizeInfo:[],increaseFrequency:1,increaseType:1,freeType:1,zeroNumTipsType:2,tipsUrl:"",startTime:null,endTime:null,increaseValue:"test",zeroList2:[],zeroList1:[]},timeList:[],sortable:null,rules:{startTime:[{required:!0,message:"不能为空",trigger:"change"}],luckDrawName:[{required:!0,message:"不能为空",trigger:"change"}],tipsUrl:[{validator:function(t,a,i){return 1==e.param.zeroNumTipsType?a&&a.trim()?i():i(new Error("必填")):i()}}],increaseValue:[{required:!0,message:"不能为空",trigger:"change"}],zeroList1:[{validator:function(t,a,i){if(1===e.param.zeroNumTipsType){var n=a.find((function(e){if("cn"===e.languageCode||"en"===e.languageCode)return e.name}));return n?i():i(new Error("不能为空"))}return i()},trigger:"blur"}]},luckPrizeTypeMap:{1:"优惠券",2:"奖品",3:"非奖品",4:"保险栓",5:"积分",6:"金币"},awardShow:!1,awardType:"add",awardData:{id:"",luckDrawId:"",luckPrizeId:"",luckPrizeType:1,luckPrizeName:[],image:"",dataList:[],onceNumber:0,pointsMax:"",pointsMin:"",winningProbability:0,winningTipsType:1,winningTipsUrl:""},freeNumber1:0,freeNumber2:0,increaseList1:[],increaseList2:[],nameLang:"cn",fullscreenLoading:!1,luckDrawId:"",curEditPrizeIndex:-1}},components:{multiLangFileUpload:l["a"],awardDialog:h},created:function(){var e=this.$route.query||{};this.type=e.type,e.id?(this.luckDrawId=e.id,this.getDetail(e.id)):this.setAddData()},mounted:function(){var e=this;this.$nextTick((function(){var t=e.$el.querySelector(".el-table__body-wrapper tbody"),a=e;e.sortable=L["default"].create(t,{ghostClass:"sortable-raffle-ghost",onUpdate:function(e){var i=e.newIndex,n=e.oldIndex,r=t.children[i],s=t.children[n];t.removeChild(r),i>n?t.insertBefore(r,s):t.insertBefore(r,s.nextSibling);var l=a.param.luckPrizeInfo.splice(n,1)[0];a.param.luckPrizeInfo.splice(i,0,l)}})}))},computed:k(k({},Object(s["mapState"])({countryList:function(e){return e.dict.countryList},languageList:function(e){return e.dict.languageList}})),{},{langTemplateList:function(){for(var e=[],t=0;t<this.languageList.length;t++){var a=this.languageList[t];e.push({languageCode:a.code,name:""})}return e},existSafeCatch:function(){var e=this.param.luckPrizeInfo.find((function(e){return 4===e.luckPrizeType}));return-1!==e}}),methods:{handleCancel:function(){this.$router.push({name:"raffleAssistant"})},onFillList:function(e){var t=this,a=this.languageList.length;if(e.length===a)return e;for(var i=JSON.parse(JSON.stringify(e)),n=function(e){var a=t.languageList[e],n=i.findIndex((function(e){return e.languageCode===a.code}));-1===n&&i.push({languageCode:a.code,name:""})},r=0;r<a;r++)n(r);return i},handleCountryChange:function(){Object.assign(this.param,{luckPrizeInfo:[]})},handleIncreaseTimeChange:function(e,t){var a=parseInt(this.param.startTime),i=parseInt(this.param.endTime),n=y()(e);(n<a||n>i)&&(this.$message.error("当前时间不在活动时间范围内，请重新选择"),this.increaseList1.splice(t,1,[{time:""}]))},setActivityTime:function(){this.timeList=this.timeList?this.timeList:[],this.param.startTime=this.timeList[0]?this.timeList[0]:"",this.param.endTime=this.timeList[1]?this.timeList[1]:"",this.timeList.length||(this.increaseList1=[{time:""}])},setAddData:function(){var e=this;this.$nextTick((function(){e.increaseList1=[{time:""}],e.increaseList2=[{time:""}],e.param.zeroList1=JSON.parse(JSON.stringify(e.langTemplateList)),e.param.zeroList2=JSON.parse(JSON.stringify(e.langTemplateList))}))},setItemData:function(e){var t=e.increaseValue?JSON.parse(e.increaseValue):[{time:null}];t=t.map((function(e){return{time:e}})),t&&t.length||(t=[{time:null}]),this.increaseList1=1==e.increaseFrequency?t:[{time:null}],this.increaseList2=2==e.increaseFrequency?t:[{time:null}];var a=this.onFillList(e.tipsDesc);this.param.zeroList1=1==e.zeroNumTipsType?a:JSON.parse(JSON.stringify(this.langTemplateList)),this.param.zeroList2=2==e.zeroNumTipsType?a:JSON.parse(JSON.stringify(this.langTemplateList)),this.freeNumber1=1==e.freeType?e.freeNumber:[],this.freeNumber2=2==e.freeType?e.freeNumber:[],e.startTime&&e.endTime&&(this.timeList=[e.startTime,e.endTime]),delete e.tipsDesc,delete e.freeNumber,delete e.increaseValue,Object.assign(this.param,e)},normalizeData:function(){var e=JSON.parse(JSON.stringify(this.param));this.timeList;return e.freeNumber=this["freeNumber"+e.freeType],e.tipsDesc=e["zeroList"+e.zeroNumTipsType],delete e.zeroList1,delete e.zeroList2,e.luckPrizeInfo=e.luckPrizeInfo.map((function(e,t){return e.sort=t+1,e})),e=this.filterData(e),e},checkData:function(){var e=k({},this.param),t=!0,a=e.luckPrizeInfo.filter((function(e){return 4==e.luckPrizeType}));return a&&1===a.length||(this.$message.error("须配置唯一一个保险栓"),t=!1),t},handleSave:function(){var e=this,t=this["increaseList"+this.param.increaseFrequency],a=[];t.forEach((function(e){e.time&&!a.includes(e.time)&&a.push(e.time)})),this.param.increaseValue=a&&a.length?JSON.stringify(a):"",this.$refs["raffleForm"].validate((function(t){if(t){var a=e.checkData();if(a){var i=e.normalizeData();e.fullscreenLoading=!0,"add"===e.type?Object(b["c"])({luckDrawTemplate:i}).then((function(t){1===t.ret.errcode&&(e.$message.success("添加成功"),e.$router.push({name:"raffleAssistant"})),e.fullscreenLoading=!1})).catch((function(t){e.fullscreenLoading=!1})):(i.luckDrawId=e.luckDrawId,Object(b["f"])({luckDrawTemplate:i}).then((function(t){1===t.ret.errcode&&(e.$message.success("修改成功"),e.$router.push({name:"raffleAssistant"})),e.fullscreenLoading=!1})).catch((function(t){console.error(t),e.fullscreenLoading=!1})))}}else e.$message.error("请先填写必填项")}))},setImg:function(e){this.param.zeroList1=e},getName:function(e,t){if(!e||!e.length)return"";var a=null;return a=e.find((function(e){return"cn"===e.languageCode})),a?a.name:""},handlePrizeItemSave:function(e){"edit"===this.awardType?this.param.luckPrizeInfo.splice(this.curEditPrizeIndex,1,e.luckItem):this.param.luckPrizeInfo.push(e.luckItem),this.awardShow=!1,console.log(this.param.luckPrizeInfo)},handleEdit:function(e,t){Object.assign(this.awardData,e),this.curEditPrizeIndex=t,this.awardShow=!0,this.awardType="edit"},handleAdd:function(){var e=this.param.luckPrizeInfo.length;e<=50?(this.awardType="add",Object.assign(this.awardData,{id:"",luckDrawId:"",luckPrizeId:"",luckPrizeType:1,luckPrizeName:[],pointsMax:"",pointsMin:"",dataList:[],image:"",onceNumber:0,winningProbability:0,winningTipsType:1,winningTipsUrl:""}),this.awardShow=!0):this.$message.info("奖品不得超过50种")},handleDelete:function(e){var t=this;this.$confirm("是否删除该奖品","提示",{type:"warning"}).then((function(){t.param.luckPrizeInfo.splice(e,1)})).catch((function(){t.$message("已取消删除")}))},getDetail:function(e){var t=this;Object(b["b"])({luckDrawId:e}).then((function(e){1===e.ret.errcode&&t.setItemData(JSON.parse(JSON.stringify(e.luckDrawInfo)))}))},handleTimeAdd:function(e){1===e?this.increaseList1.push({time:null}):this.increaseList2.push({time:null})},handleDelTime:function(e,t){var a=this;this.$confirm("是否删除该时刻","提示",{type:"warning"}).then((function(){1===e?a.increaseList1.splice(t,1):a.increaseList2.splice(t,1)}))}}},C=T,N=(a("596e"),Object(g["a"])(C,i,n,!1,null,"5dfa9350",null));t["default"]=N.exports},"0e45":function(e,t,a){},"596e":function(e,t,a){"use strict";var i=a("06e4"),n=a.n(i);n.a},"5e41":function(e,t,a){"use strict";a.d(t,"c",(function(){return n})),a.d(t,"f",(function(){return r})),a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return l})),a.d(t,"g",(function(){return o})),a.d(t,"e",(function(){return c})),a.d(t,"a",(function(){return u}));var i=a("284b");function n(e){var t=i["a"].create("LuckDrawTemplateAddReq",e);return Object(i["a"])("promotion","LuckDrawTemplateBossService.InsertLuckDrawTemplate",t,"LuckDrawTemplateAddResp")}function r(e){var t=i["a"].create("LuckDrawTemplateUpdateReq",e);return Object(i["a"])("promotion","LuckDrawTemplateBossService.UpdateLuckDrawTemplate",t,"LuckDrawTemplateUpdateResp")}function s(e){var t=i["a"].create("LuckDrawTemplateListReq",e);return Object(i["a"])("promotion","LuckDrawTemplateBossService.ListLuckDrawTemplate",t,"LuckDrawTemplateListResp")}function l(e){var t=i["a"].create("GetLuckDrawTemplateReq",e);return Object(i["a"])("promotion","LuckDrawTemplateBossService.GetLuckDrawTemplate",t,"GetLuckDrawTemplateResp")}function o(e){var t=i["a"].create("UpdateLuckPrizeQuantityReq",e);return Object(i["a"])("promotion","LuckDrawTemplateBossService.UpdateLuckPrizeQuantity",t,"UpdateLuckPrizeQuantityResp")}function c(e){var t=i["a"].create("QueryLuckPrizeInfoReq",e);return Object(i["a"])("promotion","LuckDrawTemplateBossService.QueryLuckPrizeInfo",t,"QueryLuckPrizeInfoResp")}function u(e){var t=i["a"].create("DownloadWinningUserInfoReq",e);return Object(i["a"])("promotion","LuckDrawTemplateBossService.DownloadWinningUserInfo",t,"DownloadWinningUserInfoResp")}},"7bf4":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"multi-upload-box"},[a("div",{staticClass:"multi-upload-show",on:{click:function(t){e.showDialog=!0}}},[a("div",[a("i",{staticClass:"el-icon-plus"}),a("img",{attrs:{src:e.getCnImgCover()}})])]),a("el-dialog",{attrs:{title:"添加多语言图片",width:"700px","append-to-body":"",visible:e.showDialog},on:{"update:visible":function(t){e.showDialog=t},close:function(t){e.showDialog=!1}}},[a("div",{staticClass:"multi-upload-wrapper"},[a("div",{staticClass:"all-tip"},[a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:e.handleSameAll}},[e._v("同步所有")]),e._v(" *将当前图片同步到其他所有语言项（已上传的会被覆盖）\n            ")],1),a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleTabChange},model:{value:e.curLanguage,callback:function(t){e.curLanguage=t},expression:"curLanguage"}},e._l(e.languageList,(function(t,i){return a("el-tab-pane",{key:i,attrs:{name:t.code}},[a("span",{attrs:{slot:"label"},slot:"label"},["cn"==t.code||"en"==t.code?a("i",{staticClass:"required"},[e._v("*")]):e._e(),e._v(" "+e._s(t.desc))]),a("div",{staticClass:"upload-tips"},[a("span",[e._v("上传图片：")]),a("em",[e._v("支持上传.jpg/.png/.gif格式的文件，请保持各语言版本一致")])]),e.showDialog&&e.curLanguage===t.code?a("c-upload",{attrs:{limit:e.limit,accept:e.accept,refsName:t.code+"fileUpload",fileList:e.curImgUrl,getType:e.getType,signCode:t.code},on:{setData:e.setFileList}}):e._e(),a("div",{staticClass:"all-tip"},[a("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.handleSameEmpty}},[e._v("同步至未上传图片项")]),e._v(" *将当前图片同步到其他未上传图片的语言项\n                    ")],1)],1)})),1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.handleClose}},[e._v("取 消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)])],1)},n=[],r=(a("20d6"),a("ac6a"),a("28a5"),a("7f7f"),a("7514"),a("c5f6"),a("f09b")),s={props:{propFileList:{type:Array,default:function(){return[]}},limit:{type:Number,default:1},accept:String,getType:String},data:function(){return{param:{name:""},showDialog:!1,rules:{name:[{required:!0,message:"不能为空",trigger:"change"}]},fileList:[],curLanguage:"cn",curImgUrl:""}},watch:{propFileList:{handler:function(e){var t=this;console.log(e),e&&this.$nextTick((function(){t.fileList=JSON.parse(JSON.stringify(e)),t.handleTabChange()}))},deep:!0}},components:{cUpload:r["a"]},computed:{languageList:function(){return this.$store.state.dict.languageList}},created:function(){this.fileList=JSON.parse(JSON.stringify(this.propFileList)),this.handleTabChange()},methods:{handleTabChange:function(){var e=this,t=this.fileList.find((function(t){return t.languageCode===e.curLanguage}));this.curImgUrl=t?t.name:""},getCnImgCover:function(){var e=this.propFileList.find((function(e){return"cn"==e.languageCode}));return e?this.dealShowFileSrc(e.name.split(",")[0]):""},handleSameAll:function(){var e=this;this.curImgUrl?(this.fileList=[],this.languageList.forEach((function(t){e.fileList.push({languageCode:t.code,name:e.curImgUrl})})),this.$message.success("同步成功")):this.$message.warning("请先上传当前项的图片")},handleSameEmpty:function(){var e=this;this.curImgUrl?(this.languageList.forEach((function(t){var a=e.fileList.findIndex((function(e){return e.languageCode==t.code}));-1===a&&e.fileList.push({languageCode:t.code,name:e.curImgUrl})})),this.$message.success("同步成功")):this.$message.warning("请先上传当前项的图片")},setFileList:function(e){console.log(e);var t=this.fileList.findIndex((function(t){return t.languageCode==e.signCode}));-1!=t?this.fileList[t].name=e.data:this.fileList.push({languageCode:e.signCode,name:e.data}),this.handleTabChange()},getCurrentLangFile:function(e){var t=this.fileList.find((function(t){return t.languageCode==e}));return t?t.name:""},handleClose:function(){this.fileList=JSON.parse(JSON.stringify(this.propFileList)),this.curLanguage="cn",this.handleTabChange(),this.showDialog=!1},confirm:function(){var e=this.fileList.filter((function(e){return"cn"==e.languageCode&&e.name||"en"==e.languageCode&&e.name}));if(e.length<2)return this.$message.warning("中文和英文图片不能为空");this.showDialog=!1,this.$emit("setData",this.fileList)}}},l=s,o=(a("ce00"),a("2877")),c=Object(o["a"])(l,i,n,!1,null,"423ff198",null);t["a"]=c.exports},"8c16":function(e,t,a){"use strict";var i=a("b28e"),n=a.n(i);n.a},b28e:function(e,t,a){},ce00:function(e,t,a){"use strict";var i=a("0e45"),n=a.n(i);n.a}}]);