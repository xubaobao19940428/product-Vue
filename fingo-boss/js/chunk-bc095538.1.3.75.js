(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bc095538"],{"1310b":function(e,t,r){"use strict";var n=r("3121"),o=r.n(n);o.a},3121:function(e,t,r){},"31e7":function(e,t,r){},"5c8a":function(e,t,r){},"5fd1":function(e,t,r){},6863:function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return a})),r.d(t,"m",(function(){return u})),r.d(t,"n",(function(){return s})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return i})),r.d(t,"g",(function(){return c})),r.d(t,"i",(function(){return d})),r.d(t,"o",(function(){return f})),r.d(t,"k",(function(){return p})),r.d(t,"d",(function(){return h})),r.d(t,"p",(function(){return m})),r.d(t,"l",(function(){return g})),r.d(t,"h",(function(){return v})),r.d(t,"j",(function(){return b})),r.d(t,"c",(function(){return y}));var n=r("284b");function o(e){console.log(e);var t=n["a"].create("AfterSalePageRequest",e);return Object(n["a"])("order","AfterService.AfterSalePage",t,"AfterSalePageResponse")}function a(e){console.log(e);var t=n["a"].create("AfterSaleInfoRequest",e);return Object(n["a"])("order","AfterService.AfterSaleInfo",t,"AfterSaleInfoResponse")}function u(e){console.log(e);var t=n["a"].create("ModifyAfterSaleRequest",e);return Object(n["a"])("order","AfterService.ModifyAfterSale",t,"ModifyAfterSaleResponse")}function s(e){console.log(e);var t=n["a"].create("RefundSuccessRequest",e);return Object(n["a"])("order","AfterService.RefundSuccess",t,"RefundSuccessResponse")}function l(e){console.log(e);var t=n["a"].create("AuditPassRequest",e);return Object(n["a"])("order","AfterService.AuditPass",t,"AuditPassResponse")}function i(e){console.log(e);var t=n["a"].create("BatchApprovedRequest",e);return Object(n["a"])("order","AfterService.BatchApproved",t,"BatchApprovedResponse")}function c(e){console.log(e);var t=n["a"].create("BatchRefundSuccessRequest",e);return Object(n["a"])("order","AfterService.BatchRefundSuccess",t,"BatchRefundSuccessResponse")}function d(e){console.log(e);var t=n["a"].create("DelayProcessingRequest",e);return Object(n["a"])("order","AfterService.DelayProcessing",t,"DelayProcessingResponse")}function f(e){console.log(e);var t=n["a"].create("RejectApplyRequest",e);return Object(n["a"])("order","AfterService.RejectApply",t,"RejectApplyResponse")}function p(e){console.log(e);var t=n["a"].create("GetAfterSaleProductRequest",e);return Object(n["a"])("order","AfterService.GetAfterSaleProduct",t,"GetAfterSaleProductResponse")}function h(e){console.log(e);var t=n["a"].create("ApplyForRefundV1Req",e);return Object(n["a"])("order","AfterService.ApplyForRefundV1",t,"ApplyForRefundV1Resp")}function m(e){console.log(e);var t=n["a"].create("ReturnOperValidReq",e);return Object(n["a"])("order","AfterService.ReturnOperValid",t,"ReturnOperValidResp")}function g(e){console.log(e);var t=n["a"].create("GetUserBankListReq",e);return Object(n["a"])("polypay","WithdrawalBossService.GetUserBankList",t,"polypay.GetUserBankListResp")}function v(e){console.log(e);var t=n["a"].create("ComputeReturnAmountReq",e);return Object(n["a"])("order","AfterService.ComputeReturnAmount",t,"ComputeReturnAmountResp")}function b(e){console.log(e);var t=n["a"].create("AfterSalePageRequest",e);return Object(n["a"])("order","AfterService.DownloadAfterSalePage",t,"DownloadAfterSalePageResponse")}function y(e){console.log(e);var t=n["a"].create("ReturnReasonReq",e);return Object(n["a"])("order","AfterService.AllReturnReason",t,"ReturnReasonResp")}},"773c":function(e,t,r){"use strict";var n=r("5c8a"),o=r.n(n);o.a},b6fe:function(e,t,r){"use strict";var n=r("31e7"),o=r.n(n);o.a},b899:function(e,t,r){"use strict";var n=r("5fd1"),o=r.n(n);o.a},bd35:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"order-after-sale"},[r("div",{staticClass:"after-sale"},[r("el-card",{attrs:{shadow:"always"}},[r("div",{staticClass:"step1-title"},[r("div",{staticClass:"title"},[e._v("Step1 选择售后商品")]),r("div",{staticClass:"prompt"},[e._v("多个商品系统将生成多条售后单")])]),r("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55",align:"center",fixed:"left"}}),r("el-table-column",{attrs:{label:"商品信息",width:"400",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"produt"},[r("img",{attrs:{src:e.dealShowFileSrc(t.row.productItem.productSnap.skuCover)}}),r("div",{staticClass:"product-content"},[r("div",{staticClass:"product-content-supplier"},[e._v("商品ID："+e._s(t.row.productItem.productSnap.productId))]),r("div",{staticClass:"product-content-supplier"},[e._v("skuID："+e._s(t.row.productItem.productSnap.skuId))]),r("div",{staticClass:"product-content-name"},[e._v(e._s(t.row.productItem.productSnap.productName))]),t.row.productItem.productSnap&&t.row.productItem.productSnap.attr&&0!==t.row.productItem.productSnap.attr.length?r("div",{staticClass:"product-content-supplier"},[e._v("\n                                    规格：\n                                    "),e._l(t.row.productItem.productSnap.attr,(function(t){return r("span",{key:t.attrId},[e._v(e._s(t.attrLabel)+"："+e._s(t.valueLabel)+" ")])}))],2):e._e(),r("div",{staticClass:"product-pledge"},[e._l(t.row.productItem.productSnap.afterPledge,(function(n,o){return r("div",{key:o,class:{pricess:t.row.ischose}},[e._v(e._s(n.label))])})),e._l(t.row.productItem.productSnap.arrivalPledge,(function(n,o){return r("div",{key:o,class:{pricess:t.row.ischose}},[e._v(e._s(n.label))])}))],2),r("div",{staticClass:"promotion-coupon-wrapper"},[t.row.productItem.productSnap.promotion.length>0?r("div",{staticClass:"promotion"},[r("em",[e._v("促销")]),r("div",e._l(t.row.productItem.productSnap.promotion,(function(n,o){return r("span",{key:t.$index+"-promotion"+o,staticClass:"mar-r-10"},[e._v(e._s(n.label))])})),0)]):e._e(),t.row.productItem.productSnap.coupon.length>0?r("div",{staticClass:"coupon"},[r("em",[e._v("用劵")]),r("div",e._l(t.row.productItem.productSnap.coupon,(function(n,o){return r("span",{key:t.$index+"-coupon"+o,staticClass:"mar-r-10"},[e._v(e._s(n.label))])})),0)]):e._e()])])])]}}])}),r("el-table-column",{attrs:{label:"子单编号",width:"250",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.productItem.suborderItem,(function(t,n){return r("div",{key:n,staticClass:"sub-order-wrapper"},[r("div",[e._v("发货仓库名称："+e._s(t.warehouseName))]),r("div",[e._v(e._s(t.suborderId))])])}))}}])}),r("el-table-column",{attrs:{label:"子单状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.productItem.suborderItem,(function(t,n){return r("div",{key:n,staticClass:"sub-order-wrapper"},[r("div",[e._v(e._s(e.subStatus[t.status]))])])}))}}])}),r("el-table-column",{attrs:{label:"售后数量",width:"250",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v("最多可退"+e._s(t.row.calAfterSalesAmount.refundNum))]),r("el-input-number",{attrs:{"controls-position":"right",min:1,max:t.row.calAfterSalesAmount.refundNum},on:{change:function(r){return e.handleChange(r,t.row.productItem.productSnap.skuId)}},model:{value:t.row.num,callback:function(r){e.$set(t.row,"num",r)},expression:"scope.row.num"}})]}}])}),r("el-table-column",{attrs:{label:"是否退运费",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"amount-box"},[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#C0C4CC"},on:{change:function(r){return e.freightChange(t.row.productItem.productSnap.skuId)}},model:{value:t.row.freight,callback:function(r){e.$set(t.row,"freight",r)},expression:"scope.row.freight"}})],1)]}}])})],1)],1),r("div",[r("el-row",{staticClass:"num-row",attrs:{gutter:12}},[r("el-card",{staticClass:"card",attrs:{shadow:"always"}},[r("el-col",{staticClass:"step2",attrs:{span:12}},[r("div",{staticClass:"title"},[e._v("Step2 选择退款方式")]),r("el-form",{attrs:{"label-position":"left","label-width":"80px",model:e.queryData,rules:e.queryRules}},[r("el-form-item",{attrs:{prop:"refundAmount",label:"退款总额："}},[r("div",[e._v(e._s(e.refundCurrency)+e._s(e.queryData.refundAmount)+"（含运费"+e._s(e.queryData.refundFreight)+"）")])]),r("el-form-item",{attrs:{prop:"refundType",label:"退款账户："}},[r("el-radio-group",{model:{value:e.queryData.refundType,callback:function(t){e.$set(e.queryData,"refundType",t)},expression:"queryData.refundType"}},[r("el-radio",{attrs:{label:"1"}},[e._v("积分")]),r("el-radio",{attrs:{label:"0"}},[e._v("银行卡")])],1)],1),r("div",{staticClass:"bank-meaasge"},[r("el-form-item",{attrs:{prop:"refundCardNo",label:"银行卡号："}},[r("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:e.cardChange},model:{value:e.queryData.refundCardNo,callback:function(t){e.$set(e.queryData,"refundCardNo",t)},expression:"queryData.refundCardNo"}},e._l(e.refundCardNoList,(function(e){return r("el-option",{key:e.val,attrs:{label:e.label,value:e.val}})})),1)],1),r("el-form-item",{attrs:{prop:"refundBankName",label:"银行名称："}},[r("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:e.bankChange},model:{value:e.queryData.refundBankName,callback:function(t){e.$set(e.queryData,"refundBankName",t)},expression:"queryData.refundBankName"}},e._l(e.refundBankNameList,(function(e){return r("el-option",{key:e.val,attrs:{label:e.label,value:e.val}})})),1)],1),r("el-form-item",{attrs:{prop:"refundCardholder",label:"账户名称"}},[r("el-input",{attrs:{size:"small",disabled:""},model:{value:e.queryData.refundCardholder,callback:function(t){e.$set(e.queryData,"refundCardholder",t)},expression:"queryData.refundCardholder"}})],1),r("el-form-item",{attrs:{prop:"mobile",label:"联系电话："}},[r("el-input",{attrs:{size:"small",disabled:""},model:{value:e.queryData.mobile,callback:function(t){e.$set(e.queryData,"mobile",t)},expression:"queryData.mobile"}})],1),r("el-form-item",{attrs:{prop:"email",label:"电子邮箱："}},[r("el-input",{attrs:{size:"small",disabled:""},model:{value:e.queryData.email,callback:function(t){e.$set(e.queryData,"email",t)},expression:"queryData.email"}})],1)],1)],1)],1)],1),r("el-card",{staticClass:"card",attrs:{shadow:"always"}},[r("el-col",{staticClass:"step3",attrs:{span:12}},[r("div",{staticClass:"title"},[e._v("Step3 填写售后愿意")]),r("el-form",{attrs:{"label-position":"left","label-width":"80px",model:e.reson,rules:e.rules}},[r("el-form-item",{attrs:{prop:"afterType",label:"售后类型："}},[r("el-radio-group",{model:{value:e.reson.afterType,callback:function(t){e.$set(e.reson,"afterType",t)},expression:"reson.afterType"}},[r("el-radio",{attrs:{label:"7"}},[e._v("仅退款")]),r("el-radio",{attrs:{label:"1"}},[e._v("退货退款")])],1)],1),r("el-form-item",{attrs:{label:"售后原因：",prop:"reason"}},[r("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择",size:"medium"},model:{value:e.reson.reason,callback:function(t){e.$set(e.reson,"reason",t)},expression:"reson.reason"}},e._l(e.reasonList,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),r("el-form-item",{attrs:{label:"上传凭证："}},[r("div",{staticClass:"pic-box"},[r("c-upload",{attrs:{fileList:e.reson.pic,limit:3,iscopy:!0,accept:"jpeg,jpg,png"},on:{setData:e.setCoverImg}}),r("div",{staticClass:"pic-prompt"},[e._v("支持jpg、jpeg、png，最多3张；")])],1)]),r("el-form-item",{attrs:{label:"备注说明："}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.reson.remark,callback:function(t){e.$set(e.reson,"remark",t)},expression:"reson.remark"}})],1)],1)],1)],1)],1)],1)],1),r("el-card",{staticClass:"footer",attrs:{shadow:"always"}},[r("el-button",{attrs:{type:"primary"},on:{click:e.submitAfterSale}},[e._v("提交售后")])],1),e.outBoundDialog?r("out-bound",{attrs:{dialogVisible:e.outBoundDialog,orderId:e.orderId,selectedSkuInfoList:e.selectedSkuInfoList},on:{"on-cancle":e.cancleOutBound,stepReq:e.stepReq,"on-confirm":e.confirmOutBound}}):e._e()],1)},o=[],a=(r("ac4d"),r("8a81"),r("1c4c"),r("7f7f"),r("c5f6"),r("6b54"),r("5df3"),r("4f7f"),r("75fc")),u=(r("a481"),r("96cf"),r("3b8d")),s=(r("7514"),r("28a5"),r("ac6a"),r("6863")),l=r("f09b"),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"out-bound"},[r("el-dialog",{attrs:{title:"选择要取消的出库单",visible:e.toggle,width:"850px","close-on-click-modal":!1},on:{"update:visible":function(t){e.toggle=t},close:e.cancle}},[e._l(e.selectedSkuInfoList,(function(t,n){return r("div",{key:n,staticClass:"out-order"},[r("div",{staticClass:"info-title"},[e._v(e._s(t.productName))]),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("div",{staticClass:"grid-content bg-purple"},[e._v("\n                        skuId: "+e._s(t.skuId)+"\n                    ")])]),r("el-col",{attrs:{span:8}},[r("div",{staticClass:"grid-content bg-purple"},[r("div",{staticClass:"sku-text"},[e._v("sku图片：")]),r("img",{staticClass:"sku-img",attrs:{src:e.dealShowFileSrc(t.skuCover)}})])]),r("el-col",{attrs:{span:8}},[r("div",{staticClass:"grid-content bg-purple"},[e._v("\n                        sku规格："+e._s(t.attr[0]&&t.attr[0].valueLabel)+"\n                    ")])])],1),r("el-divider",{attrs:{"content-position":"left"}},[e._v("关联出库单")]),e._l(t.skuOutOrderData,(function(t,n){return r("div",{key:n,staticClass:"out-order-item"},[r("p",[e._v("待分配数量："+e._s(t.skuCount))]),r("out-order-table",{attrs:{outOrderTableDataModel:t.outOrder}})],1)}))],2)})),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:e.cancle}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirm}},[e._v("确 定")])],1)],2)],1)},c=[],d=r("98a9"),f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"out-order-table"},[r("el-table",{ref:"",staticStyle:{width:"620px","margin-top":"16px"},attrs:{data:e.outOrderTableData,fit:"","highlight-current-row":"","header-cell-style":{background:"#F5F7FA",color:"#606266"}}},[r("el-table-column",{attrs:{label:"出库单编号",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.outId))])]}}])}),r("el-table-column",{attrs:{label:"出库单状态",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.outStatus?r("span",[e._v("已出库")]):e._e(),2===t.row.outStatus?r("span",[e._v("未出库")]):e._e(),3===t.row.outStatus?r("span",[e._v("已取消")]):e._e()]}}])}),r("el-table-column",{attrs:{label:"sku数量",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.count))])]}}])}),r("el-table-column",{attrs:{label:"取消数量",align:"left",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input-number",{attrs:{controls:!1,min:0,max:t.row.count,size:"mini"},model:{value:t.row.cancelCount,callback:function(r){e.$set(t.row,"cancelCount",r)},expression:"scope.row.cancelCount"}})]}}])})],1)],1)},p=[],h={props:{outOrderTableDataModel:{type:Array,default:function(){return[]}}},computed:{outOrderTableData:{get:function(){return this.outOrderTableDataModel},set:function(){}}},data:function(){return{}}},m=h,g=(r("1310b"),r("2877")),v=Object(g["a"])(m,f,p,!1,null,null,null),b=v.exports;function y(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=k(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return u=e.done,e},e:function(e){s=!0,a=e},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw a}}}}function k(e,t){if(e){if("string"===typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var I={props:{dialogVisible:Boolean,selectedSkuInfoList:Array,orderId:String},data:function(){return{selectedSkuInfo:[],outOrderTableDataModel:[{outId:"22434433",outStatus:1,count:1,cancelCount:null}]}},components:{OutOrderTable:b},computed:{toggle:{get:function(){return this.dialogVisible},set:function(){}}},watch:{selectedSkuInfoList:{handler:function(){},deep:!0}},mounted:function(){this.getOutOrderList()},methods:{cancle:function(){this.$emit("on-cancle")},verifyCancelCount:function(){console.log(this.selectedSkuInfoList);var e=0;return _.forEach(this.selectedSkuInfoList,(function(t){_.forEach(t.skuOutOrderData,(function(t){var r=0;_.forEach(t.outOrder,(function(e){r+=e.cancelCount})),t.skuCount!==r&&e++}))})),!(e>0)},confirm:function(){console.log(this.selectedSkuInfoList),this.verifyCancelCount()?this.$emit("on-confirm",this.selectedSkuInfoList):this.$message.warning("出库单中的取消数量总和必须等于待分配数量")},getOutOrderList:function(){var e,t=this,r=[],n=y(this.selectedSkuInfoList);try{for(n.s();!(e=n.n()).done;){var o=e.value;r.push(o.skuId)}}catch(u){n.e(u)}finally{n.f()}var a={orderId:this.orderId,skuId:r};Object(d["p"])(a).then((function(e){if(console.log(e),1===e.ret.errcode)if(0===e.item.length)t.$emit("stepReq");else{var n=e.item;n.length<r.length&&t.$confirm("特殊订单！！！暂不支持多spu同时售后，请选择单个spu，一个一个进行售后。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("on-cancle")})).catch((function(){t.$emit("on-cancle")})),_.forEach(t.selectedSkuInfoList,(function(e){_.forEach(n,(function(r){e.skuId===r.superSkuId&&(_.forEach(r.sku,(function(t){t.skuCount=t.skuCount*e.num,t.superSkuId=r.superSkuId})),_.forEach(r.sku,(function(e){_.forEach(e.outOrder,(function(r){t.$set(r,"cancelCount",0),t.$set(r,"skuId",e.skuId)}))})),console.log(r.sku),t.$set(e,"skuOutOrderData",r.sku))}))}))}})).catch((function(e){console.log(e)}))}}},C=I,w=(r("b899"),Object(g["a"])(C,i,c,!1,null,"529c4811",null)),A=w.exports;function O(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=R(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return u=e.done,e},e:function(e){s=!0,a=e},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw a}}}}function R(e,t){if(e){if("string"===typeof e)return q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?q(e,t):void 0}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var D={data:function(){return{orderId:"",tableData:[],refundCurrency:"",queryData:{refundAmount:"0",refundFreight:"0",refundType:"1",refundCardNo:"",refundBankName:"",refundCardholder:"",mobile:"",email:""},reson:{afterType:"7",reason:"",pic:[],remark:""},subStatus:{0:"待支付",1:"待发货",2:"待收货",3:"交易成功",4:"交易关闭",5:"部分发货"},reasonList:[],rules:{afterType:[{required:!0,message:"请至少选择一个",trigger:"change"}],reason:[{required:!0,message:"请至少选择一个",trigger:"change"}]},queryRules:{refundAmount:[{required:!0}],refundType:[{required:!0,message:"请至少选择一个",trigger:"change"}],refundCardNo:[{required:!0,message:"请至少选择一个",trigger:"change"}],refundBankName:[{required:!0,message:"请至少选择一个",trigger:"change"}],refundCardholder:[{required:!0,message:"请至少选择一个",trigger:"change"}],mobile:[{required:!0,message:"请至少选择一个",trigger:"change"}],email:[{required:!0,message:"请至少选择一个",trigger:"change"}]},refundBankNameList:[],refundCardNoList:[],picLists:[],skuList:[],product:[],bankList:[],outBoundDialog:!1,selectedSkuInfoList:[]}},components:{cUpload:l["a"],outBound:A},mounted:function(){this.orderId=this.$route.query.orderId,this.getAfterSaleProduct(),this.getAllReturnReason()},methods:{getAllReturnReason:function(){var e=this;Object(s["c"])({}).then((function(t){1===t.ret.errcode&&(e.reasonList=t.refundReason)}))},toggleSelection:function(e){var t=this;e&&e.forEach((function(e){t.$nextTick((function(){t.$refs.multipleTable.toggleRowSelection(e)}))}))},handleSelectionChange:function(e){console.log(e),this.skuList.splice(0),this.product.splice(0),this.selectedSkuInfoList.splice(0);var t,r=O(this.tableData);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.ischose=!1}}catch(g){r.e(g)}finally{r.f()}var o,a=[],u=O(e);try{for(u.s();!(o=u.n()).done;){var s=o.value;s.ischose=!0,this.skuList.push({skuId:s.productItem.productSnap.skuId}),this.product.push({skuId:s.productItem.productSnap.skuId,applyNum:s.num,returnFreight:s.freight}),a.push({skuId:s.productItem.productSnap.skuId,num:s.num,returnFreight:s.freight}),this.selectedSkuInfoList.push({skuId:s.productItem.productSnap.skuId,productName:s.productItem.productSnap.productName,skuCover:s.productItem.productSnap.skuCover,attr:s.productItem.productSnap.attr,outOrderCount:s.outOrderCount,num:s.num})}}catch(g){u.e(g)}finally{u.f()}var l={},i=this.product.reduce((function(e,t){return!l[t.skuId]&&(l[t.skuId]=e.push(t)),e}),[]);this.product=i;var c={},d=this.skuList.reduce((function(e,t){return!c[t.skuId]&&(c[t.skuId]=e.push(t)),e}),[]);this.skuList=d;var f={},p=this.selectedSkuInfoList.reduce((function(e,t){return!f[t.skuId]&&(f[t.skuId]=e.push(t)),e}),[]);if(this.selectedSkuInfoList=p,0!==a.length){var h={},m=a.reduce((function(e,t){return!h[t.skuId]&&(h[t.skuId]=e.push(t)),e}),[]);a=m,console.log(a),this.getComputeReturnAmount(a)}else this.queryData.refundAmount="0",this.queryData.refundFreight="0"},cardChange:function(e){console.log(e);var t,r=O(this.bankList);try{for(r.s();!(t=r.n()).done;){var n=t.value;e===n.accountNo&&(this.queryData.refundBankName=n.bankName,this.queryData.refundCardholder=n.accountName,this.queryData.mobile=n.mobile,this.queryData.email=n.email)}}catch(o){r.e(o)}finally{r.f()}},bankChange:function(e){console.log(e);var t,r=O(this.bankList);try{for(r.s();!(t=r.n()).done;){var n=t.value;e===n.bankName&&(this.queryData.refundCardNo=n.accountNo,this.queryData.refundCardholder=n.accountName,this.queryData.mobile=n.mobile,this.queryData.email=n.email)}}catch(o){r.e(o)}finally{r.f()}},setCoverImg:function(e){this.picLists=e.data.split(","),console.log(this.picLists)},arraySpanMethod:function(e){var t=e.row,r=(e.column,e.rowIndex,e.columnIndex),n=[1,4,5],o=n.find((function(e){return e==r}));if(o||0==r)return t.rowspan?{rowspan:t.rowspan,colspan:1}:{rowspan:0,colspan:0}},getAfterSaleProduct:function(){var e=this,t={orderId:this.orderId};Object(s["k"])(t).then((function(t){if(1===t.ret.errcode)if(console.log(t),0===t.afterSaleOrderProduct.length)e.$confirm("暂无可售后商品！","提示",{confirmButtonText:"知道了",cancelButtonText:"",type:"warning"}).then(Object(u["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$router.push({name:"orderList"});case 1:case"end":return t.stop()}}),t)})))).catch((function(){e.$router.push({name:"orderList"})}));else{e.getUserBankList(t.userId);for(var r=[],n=0;n<t.afterSaleOrderProduct.length;n++)Object.assign(t.afterSaleOrderProduct[n],{num:t.afterSaleOrderProduct[n].calAfterSalesAmount.refundNum,freight:!1,ischose:!1}),r.push(t.afterSaleOrderProduct[n]);e.tableData=t.afterSaleOrderProduct,1===t.afterSaleOrderProduct.length&&e.toggleSelection(r)}}))},handleChange:function(e,t){console.log(this.product);for(var r=0;r<this.product.length;r++)this.product[r].skuId===t&&(this.product[r].applyNum=e);var n,o=O(this.selectedSkuInfoList);try{for(o.s();!(n=o.n()).done;){var a=n.value;a.skuId===t&&(a.num=e)}}catch(s){o.e(s)}finally{o.f()}var u=JSON.parse(JSON.stringify(this.product).replace(/applyNum/g,"num"));this.getComputeReturnAmount(u)},getComputeReturnAmount:function(e){var t=this,r={orderId:this.orderId,product:e};Object(s["h"])(r).then((function(e){1===e.ret.errcode&&(console.log(e),t.refundCurrency=e.currency,t.queryData.refundAmount=e.returnAmount,t.queryData.refundFreight=e.returnFreight)}))},getUserBankList:function(e){var t=this,r={userId:e};Object(s["l"])(r).then((function(e){if(1===e.ret.errcode){console.log(e),t.bankList=e.data,t.refundCardNoList.splice(0),t.refundBankNameList.splice(0);for(var r=0;r<e.data.length;r++)t.refundCardNoList.push({val:e.data[r].accountNo,label:e.data[r].accountNo}),t.refundBankNameList.push({val:e.data[r].bankName,label:e.data[r].bankName})}}))},freightChange:function(e){if(0!==this.product.length){for(var t=0;t<this.product.length;t++)if(e===this.product[t].skuId){this.product[t].returnFreight=!this.product[t].returnFreight;var r=JSON.parse(JSON.stringify(this.product).replace(/applyNum/g,"num"));return console.log(r),void this.getComputeReturnAmount(r)}this.$message.error("请选择售后商品！")}else this.$message.error("请选择售后商品！")},submitAfterSale:function(){if(""===this.reson.reason)this.$message.error("请选择售后原因！");else if(0===this.product.length)this.$message.error("请选择售后商品！");else{if("0"==this.queryData.refundType&&(""===this.queryData.refundCardNo||""===this.queryData.refundBankName||""===this.queryData.refundCardholder))return void this.$message.error("请填写必填信息");this.getReturnOperValid()}},getReturnOperValid:function(){var e=this,t={operType:1,orderId:this.orderId,product:this.skuList};Object(s["p"])(t).then((function(t){if(1===t.ret.errcode)if(console.log(t),t.popContent)e.$confirm(t.popContent.detailContent,t.popContent.warnContent,{confirmButtonText:"仅提交申请",cancelButtonText:"取消",type:"warning"}).then(Object(u["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(r=0;r<e.selectedSkuInfoList.length;r++)e.selectedSkuInfoList[r].outOrderCount<=1&&e.selectedSkuInfoList.splice(r--,1);if(0===e.selectedSkuInfoList.length){t.next=5;break}e.outBoundDialog=!0,t.next=7;break;case 5:return t.next=7,e.getApplyForRefundV1();case 7:case"end":return t.stop()}}),t)})))).catch((function(){e.$message({type:"info",message:"已取消"})}));else{for(var r=0;r<e.selectedSkuInfoList.length;r++)e.selectedSkuInfoList[r].outOrderCount<=1&&e.selectedSkuInfoList.splice(r--,1);0!==e.selectedSkuInfoList.length?e.outBoundDialog=!0:e.getApplyForRefundV1()}}))},cancleOutBound:function(){this.outBoundDialog=!1},stepReq:function(){this.outBoundDialog=!1,this.getApplyForRefundV1()},confirmOutBound:function(e){this.outBoundDialog=!1,console.log(e);var t,r=[],n=[],o=[],u=[],s=O(e);try{for(s.s();!(t=s.n()).done;){var l=t.value;r.push(l.skuOutOrderData),u.push([])}}catch(S){s.e(S)}finally{s.f()}console.log(r);for(var i=0,c=r;i<c.length;i++){var d,f=c[i],p=O(f);try{for(p.s();!(d=p.n()).done;){var h=d.value;n.push(h),o.push(h.superSkuId)}}catch(S){p.e(S)}finally{p.f()}}var m=Object(a["a"])(new Set(o));console.log(n),console.log(m);for(var g=0;g<m.length;g++){var v,b=O(n);try{for(b.s();!(v=b.n()).done;){var y,k=v.value;if(m[g]===k.superSkuId)(y=u[g]).push.apply(y,Object(a["a"])(k.outOrder))}}catch(S){b.e(S)}finally{b.f()}}console.log(u),this.getApplyForRefundV1(m,u)},getApplyForRefundV1:function(e,t){var r,n=this,o="",a=O(this.bankList);try{for(a.s();!(r=a.n()).done;){var u=r.value;this.queryData.refundCardNo==u.accountNo&&(o=u.id)}}catch(b){a.e(b)}finally{a.f()}var l,i=0,c=O(this.reasonList);try{for(c.s();!(l=c.n()).done;){var d=l.value;d.value===this.reson.reason&&(i=d.code)}}catch(b){c.e(b)}finally{c.f()}var f=[];if(console.log(e),console.log(this.product),t)for(var p=0;p<this.product.length;p++)this.product[p].skuId===e[p]?f.push({applyNum:this.product[p].applyNum,returnFreight:this.product[p].returnFreight,skuId:this.product[p].skuId,out:t[p]}):f.push({applyNum:this.product[p].applyNum,returnFreight:this.product[p].returnFreight,skuId:this.product[p].skuId,out:[]});else{var h,m=O(this.product);try{for(m.s();!(h=m.n()).done;){var g=h.value;f.push({applyNum:g.applyNum,returnFreight:g.returnFreight,skuId:g.skuId,out:[]})}}catch(b){m.e(b)}finally{m.f()}}console.log(f);var v={orderId:this.orderId,reason:this.reson.reason,reasonCode:i.toString(),refundAmount:this.queryData.refundAmount,bankId:o,refundType:Number(this.queryData.refundType),afterType:Number(this.reson.afterType),remark:this.reson.remark,pic:this.picLists,refundCurrency:this.refundCurrency,product:f,mobile:this.queryData.mobile,email:this.queryData.email};console.log(v),Object(s["d"])(v).then((function(e){1===e.ret.errcode&&(console.log(e),n.$router.push({name:"afterSale"}))}))}}},L=D,N=(r("b6fe"),r("773c"),Object(g["a"])(L,n,o,!1,null,"ba3d4082",null));t["default"]=N.exports}}]);