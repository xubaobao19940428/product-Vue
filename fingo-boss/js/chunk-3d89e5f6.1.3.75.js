(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3d89e5f6"],{"0b1a":function(e,t,a){"use strict";var r=a("845b"),i=a.n(r);i.a},"5e41":function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"f",(function(){return n})),a.d(t,"d",(function(){return l})),a.d(t,"b",(function(){return s})),a.d(t,"g",(function(){return c})),a.d(t,"e",(function(){return o})),a.d(t,"a",(function(){return u}));var r=a("284b");function i(e){var t=r["a"].create("LuckDrawTemplateAddReq",e);return Object(r["a"])("promotion","LuckDrawTemplateBossService.InsertLuckDrawTemplate",t,"LuckDrawTemplateAddResp")}function n(e){var t=r["a"].create("LuckDrawTemplateUpdateReq",e);return Object(r["a"])("promotion","LuckDrawTemplateBossService.UpdateLuckDrawTemplate",t,"LuckDrawTemplateUpdateResp")}function l(e){var t=r["a"].create("LuckDrawTemplateListReq",e);return Object(r["a"])("promotion","LuckDrawTemplateBossService.ListLuckDrawTemplate",t,"LuckDrawTemplateListResp")}function s(e){var t=r["a"].create("GetLuckDrawTemplateReq",e);return Object(r["a"])("promotion","LuckDrawTemplateBossService.GetLuckDrawTemplate",t,"GetLuckDrawTemplateResp")}function c(e){var t=r["a"].create("UpdateLuckPrizeQuantityReq",e);return Object(r["a"])("promotion","LuckDrawTemplateBossService.UpdateLuckPrizeQuantity",t,"UpdateLuckPrizeQuantityResp")}function o(e){var t=r["a"].create("QueryLuckPrizeInfoReq",e);return Object(r["a"])("promotion","LuckDrawTemplateBossService.QueryLuckPrizeInfo",t,"QueryLuckPrizeInfoResp")}function u(e){var t=r["a"].create("DownloadWinningUserInfoReq",e);return Object(r["a"])("promotion","LuckDrawTemplateBossService.DownloadWinningUserInfo",t,"DownloadWinningUserInfoResp")}},"6c7b":function(e,t,a){var r=a("5ca1");r(r.P,"Array",{fill:a("36bd")}),a("9c6c")("fill")},"845b":function(e,t,a){},9877:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"raffle-assistant-wrapper app-container"},[a("el-form",{attrs:{inline:"","label-width":"80px",model:e.searchParam}},[a("el-form-item",{attrs:{label:"抽奖名称："}},[a("el-input",{attrs:{placeholder:"请输入抽奖名称"},model:{value:e.searchParam.luckDrawName,callback:function(t){e.$set(e.searchParam,"luckDrawName",t)},expression:"searchParam.luckDrawName"}})],1),a("el-form-item",{attrs:{label:"国家："}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:e.searchParam.countryCode,callback:function(t){e.$set(e.searchParam,"countryCode",t)},expression:"searchParam.countryCode"}},e._l(e.countryList,(function(e){return a("el-option",{key:e.shortCode,attrs:{label:e.nameLocal,value:e.shortCode}})})),1)],1),a("el-form-item",{attrs:{label:"抽奖密令："}},[a("el-input",{staticStyle:{width:"220px"},attrs:{placeholder:"至少8位，不支持模糊搜索"},model:{value:e.searchParam.luckDrawPassword,callback:function(t){e.$set(e.searchParam,"luckDrawPassword",t)},expression:"searchParam.luckDrawPassword"}})],1),a("el-form-item",{attrs:{label:"活动时间："}},[a("el-date-picker",{attrs:{type:"datetimerange","value-format":"timestamp","start-placeholder":"开始时间","end-placeholder":"结束时间","default-time":["00:00:00","23:59:59"]},model:{value:e.timeList,callback:function(t){e.timeList=t},expression:"timeList"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",type:"primary",size:"medium"},on:{click:function(t){return e.getList(1)}}},[e._v("查询")])],1)],1),a("div",{staticClass:"operator-container"},[e.hasPermission("BTN_RAFFLE_ASSISTANT_ADD")?a("el-button",{staticClass:"operator-item",attrs:{icon:"el-icon-plus",type:"primary",size:"medium"},on:{click:e.handleAdd}},[e._v("新增")]):e._e()],1),a("div",{staticClass:"type-container"},[a("el-button",{class:["btn-padding",0===e.searchParam.luckDrawStatus?"primary-active":""],attrs:{type:"primary",plain:"",size:"medium"},on:{click:function(t){return e.handleSelect(0)}}},[e._v("全部")]),a("el-button",{class:["btn-padding",3===e.searchParam.luckDrawStatus?"success-active":""],attrs:{type:"success",plain:"",size:"medium"},on:{click:function(t){return e.handleSelect(3)}}},[e._v("未开始")]),a("el-button",{class:["btn-padding",1===e.searchParam.luckDrawStatus?"danger-active":""],attrs:{type:"danger",plain:"",size:"medium"},on:{click:function(t){return e.handleSelect(1)}}},[e._v("进行中")]),a("el-button",{class:["btn-padding",2===e.searchParam.luckDrawStatus?"info-active":""],attrs:{type:"info",plain:"",size:"medium"},on:{click:function(t){return e.handleSelect(2)}}},[e._v("已结束")])],1),a("div",{staticClass:"main-content-wrapper"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.dataList,height:"100%"}},[a("el-table-column",{attrs:{label:"抽奖ID",fixed:"left",align:"center",prop:"luckDrawId",width:"120px"}}),a("el-table-column",{attrs:{label:"抽奖名称",align:"center",prop:"luckDrawName",width:"120px"}}),a("el-table-column",{attrs:{label:"国家",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e._f("countryFilter")(t.row.countryCode))+"\n                ")]}}])}),a("el-table-column",{attrs:{label:"抽奖密令",align:"center",prop:"luckDrawPassword",width:"240px"}}),a("el-table-column",{attrs:{label:"开始时间",align:"center",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("secondTimeFormat")(t.row.startTime)))]}}])}),a("el-table-column",{attrs:{label:"结束时间",align:"center",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("secondTimeFormat")(t.row.endTime)))]}}])}),a("el-table-column",{attrs:{label:"更新人",align:"center",prop:"operationName"}}),a("el-table-column",{attrs:{label:"更新时间",align:"center",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e._f("secondTimeFormat")(t.row.updateTime))+"\n                ")]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",fixed:"right",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasPermission("BTN_RAFFLE_ASSISTANT_POOL")?a("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(a){return e.handleGoPool(t.row.luckDrawId)}}},[e._v("奖池")]):e._e(),e.hasPermission("BTN_RAFFLE_ASSISTANT_EDIT")?a("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("编辑")]):e._e()]}}])})],1)],1),a("div",{staticClass:"pagination-box"},[a("el-pagination",{attrs:{"current-page":e.searchParam.page.pageNum,"page-size":e.searchParam.page.pageSize,layout:"sizes, total, prev, pager, next, jumper","page-sizes":[5,10,15,20],total:e.totals},on:{"current-change":e.getList,"size-change":e.handleSizeChange}})],1),e.poolShow?a("cur-pool-dialog",{attrs:{"dialog-visible":e.poolShow,luckPrizeList:e.luckPrizeList,luckDrawId:e.curLuckDrawId},on:{close:function(t){e.poolShow=!1}}}):e._e()],1)},i=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"current-pool-dialog",attrs:{title:"当前奖池",width:"650px",visible:e.dialogVisible,"close-on-click-modal":!1},on:{close:e.handleClose}},[a("div",{staticClass:"title-tip"},[e._v("以下数据分别代表：当前累计被抽中数/当前奖池累计总数/预计累计投放总数")]),a("ul",[a("el-checkbox-group",{staticClass:"pool-content-list",model:{value:e.selectluckPrizeIds,callback:function(t){e.selectluckPrizeIds=t},expression:"selectluckPrizeIds"}},e._l(e.luckPrizeList,(function(t,r){return a("li",{key:t.luckPrizeId,staticClass:"item"},[a("div",{class:[e.isShowSelect?"select-state":"opacity0"]},[a("el-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.isShowSelect,expression:"isShowSelect"}],attrs:{label:t.luckPrizeId}},[e._v(e._s(t.luckPrizeName))])],1),a("div",{staticStyle:{width:"100%",height:"200px"},attrs:{id:"chart"+r}}),a("p",{staticClass:"num-p"},[e._v(e._s(t.winningTotal+"/"+t.putTotal+"/"+t.featurePutTotal))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"close"===e.curStateList[r],expression:"curStateList[index] === 'close'"}],staticClass:"a-text",attrs:{type:"text"},on:{click:function(t){return e.handleChangeState("edit",r)}}},[e._v("修改数量")]),"edit"===e.curStateList[r]?a("div",{staticClass:"change-num-box"},[a("el-select",{staticStyle:{width:"30%"},attrs:{size:"small"},model:{value:e.param[r].tag,callback:function(t){e.$set(e.param[r],"tag",t)},expression:"param[index].tag"}},e._l(e.tagList,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1),a("el-input-number",{staticClass:"input-num-box",attrs:{controls:!1,min:1,size:"small"},model:{value:e.param[r].quantity,callback:function(t){e.$set(e.param[r],"quantity",t)},expression:"param[index].quantity"}}),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleNumChange(t.luckPrizeId,r)}}},[e._v("确定")]),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleChangeState("close",r)}}},[e._v("取消")])],1):e._e()],1)})),0)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"left"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isShowSelect,expression:"!isShowSelect"}],attrs:{type:"text",loading:e.pending},on:{click:e.handleSelect}},[e._v("选择需要导出获奖名单的奖品")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isShowSelect,expression:"isShowSelect"}],attrs:{type:"text"},on:{click:function(t){return e.handleDownload(2)}}},[e._v("确定导出")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isShowSelect,expression:"isShowSelect"}],attrs:{type:"text"},on:{click:e.handleCancelSelect}},[e._v("取消导出")])],1),a("el-button",{attrs:{size:"small"},on:{click:e.handleClose}},[e._v("取消")])],1)])},l=[],s=(a("8e6e"),a("ac6a"),a("456d"),a("7f7f"),a("6c7b"),a("bd86")),c=(a("a481"),a("c5f6"),a("313e")),o=a.n(c),u=a("5e41");function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach((function(t){Object(s["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var h={props:{dialogVisible:Boolean,luckDrawId:[String,Number]},data:function(){return{allColor:{1:"#47A2FF",2:"#66D38E",0:"#FBDA6E"},pending:!1,tagList:["-","+"],param:[],curStateList:[],luckPrizeList:[],isShowSelect:!1,selectluckPrizeIds:[]}},created:function(){this.getPoolList()},methods:{reset:function(){this.isShowSelect=!1,this.selectluckPrizeIds=[],this.curStateList=[],this.luckPrizeList=[]},handleClose:function(){this.reset(),this.$emit("close")},handleChangeState:function(e,t){this.curStateList.splice(t,1,e)},initChart:function(){for(var e=JSON.parse(JSON.stringify(this.luckPrizeList)),t=0;t<e.length;t++){var a=e[t],r=[];r.push({value:a.winningTotal,name:"当前累计被抽中数"}),r.push({value:a.putTotal,name:"当前奖池累计总数"});var i=a.luckPrizeName.replace(/(.{1,7})/g,"$1\n");this["chart"+t]=o.a.init(document.getElementById("chart"+t));var n=(t+1)%3,l=this.allColor[n];this.setOption(r,"chart"+t,i,a.winningRate,l)}},handleNumChange:function(e,t){var a=this,r=p({},this.param[t]),i=r.quantity;"-"===r.tag&&(i=parseInt("-"+i)),Object(u["g"])({luckPrizeId:e,luckDrawId:this.luckDrawId,quantity:i}).then((function(e){1===e.ret.errcode&&(a.$message.success("修改成功"),a.getPoolList())}))},getPoolList:function(){var e=this;Object(u["e"])({luckDrawId:this.luckDrawId}).then((function(t){1===t.ret.errcode&&(e.luckPrizeList=[].concat(t.queryLuckPrizeInfo),e.$nextTick((function(){e.initChart()})),e.initData(t.queryLuckPrizeInfo.length))}))},initData:function(e){this.param=new Array(e).fill({tag:"+",quantity:1}),this.curStateList=new Array(e).fill("close")},setOption:function(e,t,a,r,i){var n={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},color:[i,"#F0F2F5"],graphic:[{type:"text",left:"center",top:"34%",style:{text:a,textAlign:"center",color:"#eee",fontSize:12}},{type:"text",left:"center",top:"58%",style:{text:r,textAlign:"center",color:"#333",fontSize:20}}],series:[{data:e,type:"pie",radius:["60%","82%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1}},labelLine:{normal:{show:!1}}}]};this[t].setOption(n)},handleSelect:function(){this.isShowSelect=!0},handleCancelSelect:function(){this.selectluckPrizeIds=[],this.isShowSelect=!1},handleDownload:function(e){var t=this;this.selectluckPrizeIds.length?(this.pending=!0,Object(u["a"])({luckPrizeId:this.selectluckPrizeIds,type:e}).then((function(e){if(1===e.ret.errcode){if(e.url){var a=document.createElement("a");a.download=t.dealShowFileSrc(e.url),a.href=t.dealShowFileSrc(e.url),a.click()}t.pending=!1}else t.pending=!1})).catch((function(e){console.error(e),t.pending=!1}))):this.$message("请先选择需要导出名单的奖品")}}},m=h,f=(a("0b1a"),a("2877")),w=Object(f["a"])(m,n,l,!1,null,null,null),g=w.exports,k={data:function(){return{searchParam:{page:{pageNum:1,pageSize:10,pagingSwitch:!0},luckDrawName:"",luckDrawId:"",countryCode:"",luckDrawStatus:0,luckDrawPassword:""},totals:0,timeList:[],loading:!1,dataList:[],awardShow:!1,poolShow:!1,luckPrizeList:[],curLuckDrawId:""}},components:{curPoolDialog:g},computed:{countryList:function(){return this.$store.state.dict.countryList}},created:function(){this.getList(1)},methods:{handleSizeChange:function(e){this.searchParam.page.pageSize=e,this.getList(1)},handleSelect:function(e){this.searchParam.luckDrawStatus=e,this.getList(1)},handleAdd:function(){this.$router.push({name:"raffleOperator",query:{type:"add"}})},handleEdit:function(e){this.$router.push({name:"raffleOperator",query:{type:"edit",id:e.luckDrawId}})},handleGoPool:function(e){this.curLuckDrawId=e,this.poolShow=!0},getList:function(e){var t=this;this.loading=!0,this.searchParam.page.pageNum=e||this.searchParam.page.pageNum,this.timeList=this.timeList||[];var a={};a=this.filterData(Object.assign(this.searchParam,{startTime:this.timeList[0]?this.timeList[0]:null,endTime:this.timeList[1]?this.timeList[1]:null})),Object(u["d"])(a).then((function(e){1===e.ret.errcode&&(t.dataList=e.luckDrawInfo,t.totals=e.total),t.loading=!1})).catch((function(e){console.error(e),t.loading=!1}))}}},b=k,v=(a("bee5"),Object(f["a"])(b,r,i,!1,null,"0f6d8dbc",null));t["default"]=v.exports},bee5:function(e,t,a){"use strict";var r=a("d548"),i=a.n(r);i.a},d548:function(e,t,a){}}]);